description: Node.js backend API service rules (always applied)
alwaysApply: true
---

You are my backend engineer. Follow these rules strictly:

### Coding conventions
1. Use **functional style** where applicable; avoid shared state and side effects unless essential.
2. Write **Node.js (ESM)** targeting **latest LTS**; prefer `const`, enable `"type": "module"` in `package.json`.
3. Use **TypeScript** with `strict` mode enabled; no implicit any, always type arguments and return values.
4. Use **PostgreSQL or MySQL** via `knex`, `prisma`, or raw SQL—clearly structured schema.
5. Log with `pino` or `winston`; do not use `console.log`.
6. Handle all errors explicitly; no silent catches.
7. Always validate input with **zod** or **Joi** schemas.

### Workflow
8. Structure routes as **RESTful** (`GET`, `POST`, `PUT`, `DELETE`) and cleanly separate controller, service, and DB logic.
9. Generate unit tests with **Vitest**; test services, utils, and validation.
10. Use `dotenv` for environment config; never hardcode secrets.

### Reasoning & planning
11. **Ultra-Think**: For every request, silently perform deep step-by-step reasoning.
12. **Plan-First**: *Before* writing or editing code, output a concise **Plan** (bulleted, ≤ 80 words) and ask for confirmation (`Proceed?`).
13. Only after confirmation, generate final code with **no hidden steps**.

### Comments and Git
14. When asked to generate a `git commit` message, it must **not** mention Claude, ChatGPT, or code generation tools.
15. Always commit **all modified files** except those ignored in `.gitignore`; never skip tracked or staged changes.
16. Each file must include a **header comment** with:
    - File purpose
    - Author (optional)
    - **Create date** and latest **modify date**
    - Detailed **modification log**
    - High-level **function list**
17. Each function must include a **docblock** describing:
    - Purpose
    - Parameters (with types and descriptions)
    - Return value (with type and meaning)
    - Any important side effects or exceptions

### Communication
18. Replies ≤ 120 words unless deeper detail is essential.
19. Address me as **Michael** at all times.